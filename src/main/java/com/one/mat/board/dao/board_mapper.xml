<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.one.mat.board.dao.BoardDAO">	
	<select id="list" resultType="com.one.mat.board.dto.BoardDTO">
    SELECT
        board_id,
        board_subject,
        m.member_nickName,
        board_regDate,  
        board_bHit
    FROM board b
    INNER JOIN member m ON b.member_idx = m.member_idx
    ORDER BY board_id DESC
    LIMIT #{param1} OFFSET #{param2}
	</select>
	
	<select id="totalPage" resultType="int">
		SELECT CEIL(COUNT(board_id)/#{param1}) AS pages FROM board
	</select>
	
	<insert 
		useGeneratedKeys="true"
		keyColumn="board_id"
		keyProperty="board_id"
	id="writeBoard" parameterType="com.one.mat.board.dto.BoardDTO">
	INSERT INTO board(board_subject,member_idx,board_content)VALUES(#{board_subject},#{member_idx},#{board_content})
	</insert>
	
	<insert id="writePhoto">
	    INSERT INTO photo(photo_type, photo_idfNum, photo_fileName, photo_uploadDate)
	    VALUES (1, #{param1}, #{param2}, NOW())
	</insert>
	
	<update id="bHit">
	    UPDATE board SET board_bHit = board_bHit + 1 WHERE board_id = #{param1}
	</update>
	
	<!-- 
	<select id="detail" resultType="com.one.mat.board.dto.BoardDTO">
		SELECT * FROM board WHERE board_id = #{param1}
	</select>	
	 -->
	 <select id="detail" resultType="com.one.mat.board.dto.BoardDTO">
	    SELECT
	        board_id,
	        board_subject,
	        m.member_nickName,
	        board_regDate,  
	        board_bHit,
	        board_content
	    FROM board b
	    INNER JOIN member m ON b.member_idx = m.member_idx
	    WHERE board_id = #{param1}
	</select>
	 
	 <!-- 
	<select id="getPhoto" resultType="com.one.mat.board.dto.PhotoDTO">
	    SELECT * FROM photo WHERE board_id = #{param1}
	</select>
	  -->
	<select id="getPhoto" resultType="com.one.mat.board.dto.PhotoDTO">
	    SELECT
	        photo_id,
	        photo_fileName
	    FROM photo
	    WHERE photo_idxNum = (SELECT board_id FROM board WHERE board_id = #{param1})
	</select>
	  
	
	<delete id="del">
		DELETE FROM board WHERE board_id = #{param1}
	</delete>
	
	<update id="update" parameterType="map">
	    UPDATE board SET board_subject = #{subject}, member_idx = #{member_idx}, board_content = #{content}
	    WHERE board_id = #{board_id} 
	</update>
	
</mapper>